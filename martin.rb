#
# ATTENTION: This is an autogenerated file. See original at
#            https://github.com/maplibre/martin/blob/main/.github/templates/homebrew.martin.rb.j2
#

class Martin < Formula
  current_version="0.9.3"

  desc "Blazing fast and lightweight tile server with PostGIS, MBTiles, and PMTiles support, plus an mbtiles tool"
  homepage "https://github.com/maplibre/martin"

  on_macos do
    on_arm do
      sha256 "46f4f4ca2f299ae23431fe030de647b6f93697ca0f1f9ea0bcba0bdbc4d73ea3}"
      url "https://github.com/maplibre/martin/releases/download/v#{current_version}/martin-Darwin-aarch64.tar.gz"
    end
    on_intel do
      sha256 "c0c3069a1ee96f30c1fe31112b8ec7ceed5cadb04a0dce449f5aee54de7e8f4f"
      url "https://github.com/maplibre/martin/releases/download/v#{current_version}/martin-Darwin-x86_64.tar.gz"
    end
  end

  on_linux do
    on_arm do
      sha256 "78790b1f94bfeb644cff800c8daa844159934fe471ae7c09b1e8543f0fc6dcb0"
      url "https://github.com/maplibre/martin/releases/download/v#{current_version}/martin-Linux-aarch64-musl.tar.gz"
    end
    on_intel do
      sha256 "b017c64bfc5f55fe9869510b91b357af47e497c60422201cfb197a6caa100e9a"
      url "https://github.com/maplibre/martin/releases/download/v#{current_version}/martin-Linux-x86_64-musl.tar.gz"
    end
  end

  version "#{current_version}"

  def install
    bin.install "martin"
    bin.install "mbtiles"
  end

  def caveats; <<~EOS
    Martin requires a database connection string.
    It can be passed as a command-line argument or as a DATABASE_URL environment variable.
      martin postgres://postgres@localhost/db
  EOS
  end

  test do
    `#{bin}/martin --version`
    `#{bin}/mbtiles --version`
  end
end
